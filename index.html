<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <title>Milk Ledger Pro</title>
    <style>
        :root { --glass: rgba(255, 255, 255, 0.12); --glow: #00d2ff; --danger: #ff4d4d; }
        body { 
            margin: 0; font-family: 'Segoe UI', sans-serif; color: white;
            background: #001219; background-image: url('https://images.unsplash.com/photo-1518173946687-a4c8a9ba332f?auto=format&fit=crop&w=1000&q=80');
            background-size: cover; background-position: center; background-attachment: fixed; min-height: 100vh;
        }
        
        /* Layout */
        .drawer { position: fixed; left: -280px; top: 0; width: 280px; height: 100%; background: rgba(0,0,0,0.95); backdrop-filter: blur(25px); transition: 0.4s; z-index: 1000; }
        .drawer.open { left: 0; }
        .drawer a { display: block; padding: 20px; color: white; text-decoration: none; border-bottom: 1px solid #333; cursor: pointer; }
        
        .top-nav { padding: 20px; display: flex; align-items: center; background: rgba(0,0,0,0.6); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 900; }
        .hamburger { font-size: 30px; cursor: pointer; margin-right: 20px; }
        
        .container { max-width: 500px; margin: auto; padding: 20px; animation: slideUp 0.5s ease; }
        .card { background: var(--glass); backdrop-filter: blur(30px); border-radius: 24px; border: 1px solid rgba(255,255,255,0.15); padding: 25px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        .total-glow { font-size: 48px; font-weight: 800; color: var(--glow); text-shadow: 0 0 25px rgba(0, 210, 255, 0.4); text-align: center; }
        
        input { width: 100%; padding: 15px; margin: 10px 0; border-radius: 12px; border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.4); color: white; font-size: 16px; box-sizing: border-box; outline: none; }
        button { width: 100%; padding: 18px; border-radius: 15px; border: none; background: var(--glow); font-weight: bold; color: #001219; font-size: 17px; cursor: pointer; transition: 0.2s; margin-top: 10px; }
        button:active { transform: scale(0.98); opacity: 0.9; }
        
        /* List Styles */
        .entry-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .delete-btn { background: none; border: none; color: var(--danger); font-size: 20px; width: auto; margin: 0; padding: 0 0 0 15px; }

        @keyframes slideUp { from {opacity: 0; transform: translateY(20px);} to {opacity: 1; transform: translateY(0);} }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="loginPage" class="hidden" style="height:100vh; display:flex; align-items:center; justify-content:center;">
        <div class="card" style="width:300px; text-align:center;">
            <h2>üîê Secure Access</h2>
            <input type="password" id="passInput" placeholder="Password">
            <button onclick="checkLogin()">UNLOCK</button>
        </div>
    </div>

    <div id="appPage" class="hidden">
        <div class="drawer" id="drawer">
            <a onclick="showSection('home')">üíß Add Delivery</a>
            <a onclick="showSection('history')">üìÖ History / Edit</a>
            <a onclick="logout()" style="color:var(--danger)">üîí Lock App</a>
        </div>

        <div class="top-nav">
            <div class="hamburger" onclick="toggleDrawer()">‚ò∞</div>
            <div style="font-weight:bold;">MILK LEDGER PRO</div>
        </div>

        <div class="container">
            <div id="homeSection">
                <div class="card">
                    <div class="total-glow" id="totalDisplay">‚Çπ0</div>
                    <p style="text-align:center; opacity:0.6;">TOTAL DUE THIS MONTH</p>
                </div>
                <div class="card">
                    <h3 style="margin-top:0;">Log Entry</h3>
                    <input type="date" id="logDate">
                    <input type="number" step="0.1" id="qty" placeholder="Liters (e.g. 1.0)" value="1.0">
                    <input type="number" id="rate" placeholder="Rate (e.g. 60)" value="60">
                    <button onclick="addEntry()">SAVE ENTRY</button>
                </div>
            </div>

            <div id="historySection" class="hidden">
                <div class="card">
                    <h3>Monthly Records</h3>
                    <div id="entriesList"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // --- 1. PASTE YOUR FIREBASE CONFIG 
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, where, onSnapshot, deleteDoc, doc, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
      const firebaseConfig = {
  apiKey: "AIzaSyBZsSTGkyS7zJxnckhCF17PYLs4mzDk1iY",
  authDomain: "milk-app-d3d4b.firebaseapp.com",
  projectId: "milk-app-d3d4b",
  storageBucket: "milk-app-d3d4b.firebasestorage.app",
  messagingSenderId: "18077804351",
  appId: "1:18077804351:web:940c2c9ebb80dc5b33558a"
};

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const COLL = "milk_records";

        // --- APP LOGIC ---
        let currentMonth = new Date().toISOString().slice(0, 7); // YYYY-MM

        window.addEventListener('load', () => {
            document.getElementById('logDate').valueAsDate = new Date();
            if(localStorage.getItem('milk_auth') === 'true') showApp();
            else document.getElementById('loginPage').classList.remove('hidden');
        });

        window.checkLogin = () => {
            if(document.getElementById('passInput').value === 'admin') { // Simple Password
                localStorage.setItem('milk_auth', 'true');
                showApp();
            } else alert('Wrong Password');
        }

        window.logout = () => {
            localStorage.removeItem('milk_auth');
            location.reload();
        }

        function showApp() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('appPage').classList.remove('hidden');
            loadData();
        }

        // Drawer & Navigation
        window.toggleDrawer = () => document.getElementById('drawer').classList.toggle('open');
        window.showSection = (id) => {
            document.getElementById('homeSection').classList.add('hidden');
            document.getElementById('historySection').classList.add('hidden');
            document.getElementById(id + 'Section').classList.remove('hidden');
            toggleDrawer();
        }

        // Firebase Functions
        function loadData() {
            const q = query(collection(db, COLL), orderBy("date", "desc"));
            
            onSnapshot(q, (snapshot) => {
                let total = 0;
                let html = "";
                
                snapshot.forEach((doc) => {
                    const d = doc.data();
                    // Only calculate for current month
                    if(d.date.startsWith(currentMonth)) {
                        total += (d.qty * d.rate);
                    }
                    
                    html += `
                        <div class="entry-item">
                            <div><b>${d.date}</b><br><small>${d.qty}L @ ‚Çπ${d.rate}</small></div>
                            <div style="display:flex; align-items:center;">
                                <span style="font-weight:bold; color:var(--glow)">‚Çπ${Math.round(d.qty * d.rate)}</span>
                                <button class="delete-btn" onclick="deleteEntry('${doc.id}')">üóëÔ∏è</button>
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('totalDisplay').innerText = "‚Çπ" + Math.round(total);
                document.getElementById('entriesList').innerHTML = html || "<p>No records found.</p>";
            });
        }

        window.addEntry = async () => {
            const date = document.getElementById('logDate').value;
            const qty = document.getElementById('qty').value;
            const rate = document.getElementById('rate').value;
            
            await addDoc(collection(db, COLL), { date, qty, rate });
            alert("Added!");
        }

        window.deleteEntry = async (id) => {
            if(confirm("Delete this?")) await deleteDoc(doc(db, COLL, id));
        }
    </script>
</body>
</html>
